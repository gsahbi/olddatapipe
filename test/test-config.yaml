version: 1.0
pipeline:
  -
    kind: fs_scan
    spec:
      url: osfs:////Users/sahbi/dev/sftp
      filter : "reg08*.csv"
      walk: false

  -
    kind: csv_panda
    spec:
      dtype:
        -
          column: Status
          type: str
  -
    kind: tidy_panda
    spec:
      -
        kind: dropcol
        spec:
          columns:
            - 4
            - 5
      -
        kind: replace
        spec:
          column: 2
          new_column: from_operator
          regex: true
          remap:
            -
              match: ^.*VIVA.*
              value: stc
            -
              match: .*ZAIN.*
              value: Zain
            -
              match: IBCF_(H|S)\d+
              value: Ooredoo
      -
        kind: replace
        spec:
          column: 3
          new_column: to_operator
          remap:
            -
              match: .*VIVA.*
              value: stc
            -
              match: .*ZAIN.*
              value: Zain
            -
              match: IBCF_(H|S)\d+
              value: Ooredoo
      -
        kind: replace
        spec:
          column: Status
          new_column: status_group
          remap:
            match: ^(\d)(?:\d\d)$
            value: \1xx
      - fix_column_names
      -
        kind: replace
        spec:
          column: q850_1st_release_cause
          new_column: q850_code
          remap:
            match: ^.*\((\d+)\).*
            value: \1
      -
        kind: join
        spec:
          columns:
            - status
            - q850_code
          new_column: status_q850
          separator: "-"
  -
    kind: influx_line
    spec:
      measurement: nio_unc
      ts:
        method: column
        column: 1
        format: '%Y%m%d-%H%M'
      fields:
        - count
      tags:
        - status_q850
