version: 1.0
pipeline:
  -
    kind: fs_scan
    spec:
      url: osfs:////Users/sahbi/dev/sftp
      filter : "*.csv"
      walk: false

  - csv_panda
  -
    kind: tidy_panda
    spec:
      -
        kind: melt
        spec:
          id_vars: 1
      - dropna
      -
        kind: split
        spec:
          col: 2
          sep: " - "
          collapse: 3
          new_cols:
            - node
            - port
            - desc
            - metric
      -
        kind: pivot
        spec:
          index:
            - 1
            - node
            - port
          columns: metric
          values: value
      - fix_column_names
  -
    kind: influx_line
    spec:
      measurement: nio_unc
      ts:
        method: column
        column: 1
        format: 's'   #'^\w+_(\d{8}-\d{4})'
      fields:
        - hc_out_octets
        - hc_in_octets
        - availability
      tags:
        - node
        - port
