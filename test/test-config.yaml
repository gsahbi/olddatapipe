version: 1.0
pipeline:
  -
    kind: fs_scan
    spec:
      url: osfs:////Users/sahbi/dev/sftp
      filter : "reg08*.csv"
      walk: false

  -
    kind: csv_panda
    spec:
      dtype:
        -
          column: Status
          type: str
  -
    kind: tidy_panda
    spec:
      -
        kind: dropcol
        spec:
          columns:
            - 4
            - 5
      -
        kind: replace
        spec:
          column: 2
          new_column: from_operator
          regex: true
          remap:
            -
              match: ^.*VIVA.*
              value: stc
            -
              match: .*ZAIN.*
              value: Zain
            -
              match: IBCF_(H|S)\d+
              value: Ooredoo
      -
        kind: replace
        spec:
          column: 3
          new_column: to_operator
          remap:
            -
              match: .*VIVA.*
              value: stc
            -
              match: .*ZAIN.*
              value: Zain
            -
              match: IBCF_(H|S)\d+
              value: Ooredoo
      -
        kind: replace
        spec:
          column: 4
          new_column: status_group
          remap:
            -
              match: (\d)(?:\d\d)
              value: \1xx
      - fix_column_names
  -
    kind: influx_line
    spec:
      measurement: nio_unc
      ts:
        method: column
        column: 1
        format: '%Y%m%d-%H%M'
      fields:
        - count
      tags:
        - 2
        - 3
        - 4
        - 5
        - 7
        - 8
        - 9
